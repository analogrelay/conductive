{"version":3,"file":"conductive.js","sources":["../../src/zone.ts","../../src/host.ts","../../src/index.ts"],"sourcesContent":["/**\n * Represents a Conductive Zone\n * \n * A Conductive Zone is a DOM element that represents an independent fragment of the page that acts like a frame.\n * Clicking a link within a Conductive Zone will cause Conductive to request the link's href,\n * extract the matching Conductive Zone from the response,\n * and replace the current Conductive Zone with the new content.\n */\nexport class ConductiveZone\n{\n    handleClick(event: MouseEvent) {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    shouldHandleClick(event: MouseEvent): boolean {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    #element: HTMLElement;\n    constructor(element: HTMLElement) {\n        this.#element = element;\n    }\n\n    async navigate(href: string) {\n        console.log(\"navigating to \" + href);\n        let resp = await fetch(href);\n        if (resp.status != 200) {\n            throw new Error(\"Yikes\");\n        }\n\n        let html = await resp.text();\n        let host = document.createElement(\"html\");\n        host.innerHTML = html;\n\n        // Grab the body from the response\n        let body = host.querySelector(\"body\");\n        if (!body) {\n            // Can't replace!\n            throw new Error(\"Yikes\");\n        }\n\n        // Swaperoonie!\n        document.body.parentElement.replaceChild(body, document.body);\n        window.history.pushState({}, \"\", href);\n    }\n}\n\nexport class ConductiveZoneElement extends HTMLElement {\n    zone: ConductiveZone;\n\n    constructor() {\n        super();\n        this.zone = new ConductiveZone(this);\n    }\n}\n","import { ConductiveZone, ConductiveZoneElement } from \"./zone\";\n\nexport class ConductiveHost {\n    #listenRoot: EventTarget;\n    #rootZone: ConductiveZone;\n\n    constructor(rootZone: HTMLElement, listenRoot: EventTarget) {\n        this.#rootZone = new ConductiveZone(rootZone);\n        this.#listenRoot = listenRoot;\n\n        // Capture clicks\n        this.#listenRoot.addEventListener(\"click\", this.#onClick.bind(this), { capture: true });\n    }\n\n    #onClick(event: MouseEvent) {\n        if (!(event.target instanceof HTMLElement)) {\n            return;\n        }\n\n        // Look for a conductive element above us, if none is found, use the body.\n        let zone = this.#findZone(event.target);\n\n        // Give the zone the chance to handle the click\n        if (zone.shouldHandleClick(event)) {\n            event.preventDefault();\n            zone.handleClick(event);\n        }\n    }\n\n    #findZone(element: HTMLElement): ConductiveZone {\n        let parent = element.closest(\"conductive-zone\");\n        if (parent && parent instanceof ConductiveZoneElement) {\n            return parent.zone;\n        }\n        return this.#rootZone;\n    }\n\n    async navigate(href: string) {\n        console.log(\"navigating to \" + href);\n        let resp = await fetch(href);\n        if (resp.status != 200) {\n            throw new Error(\"Yikes\");\n        }\n\n        let html = await resp.text();\n        let host = document.createElement(\"html\");\n        host.innerHTML = html;\n\n        // Grab the body from the response\n        let body = host.querySelector(\"body\");\n        if (!body) {\n            // Can't replace!\n            throw new Error(\"Yikes\");\n        }\n\n        // Reattach listener\n\n        // Swaperoonie!\n        document.body.parentElement.replaceChild(body, document.body);\n        window.history.pushState({}, \"\", href);\n    }\n}","import { ConductiveZoneElement } from \"./zone\";\nimport { ConductiveHost } from \"./host\";\n\nfunction isModule() {\n    return (typeof define == \"function\" && define.amd) ||\n        (typeof exports == \"object\" && typeof module !== \"undefined\");\n}\n\nif (window && !isModule()) {\n    // Auto load\n    // TODO: Make it possible to disable this?\n    document.addEventListener(\"DOMContentLoaded\", () => {\n        new ConductiveHost(document.body, window);\n    });\n    window.customElements.define(\"conductive-zone\", ConductiveZoneElement);\n}"],"names":["ConductiveZone","handleClick","event","Error","shouldHandleClick","constructor","element","navigate","href","console","log","resp","fetch","status","html","text","host","document","createElement","innerHTML","body","querySelector","parentElement","replaceChild","window","history","pushState","ConductiveZoneElement","HTMLElement","zone","ConductiveHost","rootZone","listenRoot","addEventListener","bind","capture","target","preventDefault","parent","closest","isModule","define","amd","exports","module","customElements"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,MAAMA,cAAN,CACP;IACIC,WAAW,CAACC,KAAD,EAAoB;EAC3B,IAAA,MAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN,CAAA;EACH,GAAA;;IAEDC,iBAAiB,CAACF,KAAD,EAA6B;EAC1C,IAAA,MAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN,CAAA;EACH,GAAA;;IAGDE,WAAW,CAACC,OAAD,EAAuB;EAAA,IAAA,0BAAA,CAAA,IAAA,EAAA,QAAA,EAAA;EAAA,MAAA,QAAA,EAAA,IAAA;EAAA,MAAA,KAAA,EAAA,KAAA,CAAA;EAAA,KAAA,CAAA,CAAA;;EAC9B,IAAA,qBAAA,CAAA,IAAA,EAAA,QAAA,EAAgBA,OAAhB,CAAA,CAAA;EACH,GAAA;;IAEa,MAARC,QAAQ,CAACC,IAAD,EAAe;EACzBC,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAA,GAAmBF,IAA/B,CAAA,CAAA;EACA,IAAA,IAAIG,IAAI,GAAG,MAAMC,KAAK,CAACJ,IAAD,CAAtB,CAAA;;EACA,IAAA,IAAIG,IAAI,CAACE,MAAL,IAAe,GAAnB,EAAwB;EACpB,MAAA,MAAM,IAAIV,KAAJ,CAAU,OAAV,CAAN,CAAA;EACH,KAAA;;EAED,IAAA,IAAIW,IAAI,GAAG,MAAMH,IAAI,CAACI,IAAL,EAAjB,CAAA;EACA,IAAA,IAAIC,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAX,CAAA;EACAF,IAAAA,IAAI,CAACG,SAAL,GAAiBL,IAAjB,CATyB;;EAYzB,IAAA,IAAIM,IAAI,GAAGJ,IAAI,CAACK,aAAL,CAAmB,MAAnB,CAAX,CAAA;;MACA,IAAI,CAACD,IAAL,EAAW;EACP;EACA,MAAA,MAAM,IAAIjB,KAAJ,CAAU,OAAV,CAAN,CAAA;EACH,KAhBwB;;;MAmBzBc,QAAQ,CAACG,IAAT,CAAcE,aAAd,CAA4BC,YAA5B,CAAyCH,IAAzC,EAA+CH,QAAQ,CAACG,IAAxD,CAAA,CAAA;MACAI,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiClB,IAAjC,CAAA,CAAA;EACH,GAAA;;EAnCL,CAAA;EAsCO,MAAMmB,qBAAN,SAAoCC,WAApC,CAAgD;EAGnDvB,EAAAA,WAAW,GAAG;EACV,IAAA,KAAA,EAAA,CAAA;;EADU,IAAA,eAAA,CAAA,IAAA,EAAA,MAAA,EAAA,KAAA,CAAA,CAAA,CAAA;;EAEV,IAAA,IAAA,CAAKwB,IAAL,GAAY,IAAI7B,cAAJ,CAAmB,IAAnB,CAAZ,CAAA;EACH,GAAA;;EANkD;;;;;;;;;;EC7ChD,MAAM8B,cAAN,CAAqB;EAIxBzB,EAAAA,WAAW,CAAC0B,QAAD,EAAwBC,UAAxB,EAAiD;EAAA,IAAA,2BAAA,CAAA,IAAA,EAAA,SAAA,CAAA,CAAA;;EAAA,IAAA,2BAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EAAA,IAAA,0BAAA,CAAA,IAAA,EAAA,WAAA,EAAA;EAAA,MAAA,QAAA,EAAA,IAAA;EAAA,MAAA,KAAA,EAAA,KAAA,CAAA;EAAA,KAAA,CAAA,CAAA;;EAAA,IAAA,0BAAA,CAAA,IAAA,EAAA,SAAA,EAAA;EAAA,MAAA,QAAA,EAAA,IAAA;EAAA,MAAA,KAAA,EAAA,KAAA,CAAA;EAAA,KAAA,CAAA,CAAA;;EACxD,IAAA,qBAAA,CAAA,IAAA,EAAA,SAAA,EAAiB,IAAIhC,cAAJ,CAAmB+B,QAAnB,CAAjB,CAAA,CAAA;;MACA,qBAAmBC,CAAAA,IAAAA,EAAAA,WAAAA,EAAAA,UAAnB,EAFwD;;;MAKxD,qBAAiBC,CAAAA,IAAAA,EAAAA,WAAAA,CAAAA,CAAAA,gBAAjB,CAAkC,OAAlC,EAA2C,kDAAcC,IAAd,CAAmB,IAAnB,CAA3C,EAAqE;EAAEC,MAAAA,OAAO,EAAE,IAAA;OAAhF,CAAA,CAAA;EACH,GAAA;;IAyBa,MAAR5B,QAAQ,CAACC,IAAD,EAAe;EACzBC,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAA,GAAmBF,IAA/B,CAAA,CAAA;EACA,IAAA,IAAIG,IAAI,GAAG,MAAMC,KAAK,CAACJ,IAAD,CAAtB,CAAA;;EACA,IAAA,IAAIG,IAAI,CAACE,MAAL,IAAe,GAAnB,EAAwB;EACpB,MAAA,MAAM,IAAIV,KAAJ,CAAU,OAAV,CAAN,CAAA;EACH,KAAA;;EAED,IAAA,IAAIW,IAAI,GAAG,MAAMH,IAAI,CAACI,IAAL,EAAjB,CAAA;EACA,IAAA,IAAIC,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAX,CAAA;EACAF,IAAAA,IAAI,CAACG,SAAL,GAAiBL,IAAjB,CATyB;;EAYzB,IAAA,IAAIM,IAAI,GAAGJ,IAAI,CAACK,aAAL,CAAmB,MAAnB,CAAX,CAAA;;MACA,IAAI,CAACD,IAAL,EAAW;EACP;EACA,MAAA,MAAM,IAAIjB,KAAJ,CAAU,OAAV,CAAN,CAAA;EACH,KAhBwB;EAoBzB;;;MACAc,QAAQ,CAACG,IAAT,CAAcE,aAAd,CAA4BC,YAA5B,CAAyCH,IAAzC,EAA+CH,QAAQ,CAACG,IAAxD,CAAA,CAAA;MACAI,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiClB,IAAjC,CAAA,CAAA;EACH,GAAA;;EA1DuB,CAAA;;EAYfN,SAAAA,SAAAA,CAAAA,OAAmB;EACxB,EAAA,IAAI,EAAEA,KAAK,CAACkC,MAAN,YAAwBR,WAA1B,CAAJ,EAA4C;EACxC,IAAA,OAAA;EACH,GAHuB;;;IAMxB,IAAIC,IAAI,GAAG,sBAAA,CAAA,IAAH,EAAG,SAAA,EAAA,UAAA,CAAA,CAAA,IAAA,CAAA,IAAH,EAAkB3B,KAAK,CAACkC,MAAxB,CAAR,CANwB;;;EASxB,EAAA,IAAIP,IAAI,CAACzB,iBAAL,CAAuBF,KAAvB,CAAJ,EAAmC;EAC/BA,IAAAA,KAAK,CAACmC,cAAN,EAAA,CAAA;MACAR,IAAI,CAAC5B,WAAL,CAAiBC,KAAjB,CAAA,CAAA;EACH,GAAA;EACJ,CAAA;;EAESI,SAAAA,UAAAA,CAAAA,SAAsC;EAC5C,EAAA,IAAIgC,MAAM,GAAGhC,OAAO,CAACiC,OAAR,CAAgB,iBAAhB,CAAb,CAAA;;EACA,EAAA,IAAID,MAAM,IAAIA,MAAM,YAAYX,qBAAhC,EAAuD;MACnD,OAAOW,MAAM,CAACT,IAAd,CAAA;EACH,GAAA;;EACD,EAAA,OAAA,qBAAA,CAAO,IAAP,EAAA,SAAA,CAAA,CAAA;EACH;;EChCL,SAASW,QAAT,GAAoB;EAChB,EAAA,OAAQ,OAAOC,MAAP,IAAiB,UAAjB,IAA+BA,MAAM,CAACC,GAAvC,IACF,OAAOC,OAAP,IAAkB,QAAlB,IAA8B,OAAOC,MAAP,KAAkB,WADrD,CAAA;EAEH,CAAA;;EAED,IAAIpB,MAAM,IAAI,CAACgB,QAAQ,EAAvB,EAA2B;EACvB;EACA;EACAvB,EAAAA,QAAQ,CAACgB,gBAAT,CAA0B,kBAA1B,EAA8C,MAAM;EAChD,IAAA,IAAIH,cAAJ,CAAmBb,QAAQ,CAACG,IAA5B,EAAkCI,MAAlC,CAAA,CAAA;KADJ,CAAA,CAAA;EAGAA,EAAAA,MAAM,CAACqB,cAAP,CAAsBJ,MAAtB,CAA6B,iBAA7B,EAAgDd,qBAAhD,CAAA,CAAA;EACH;;;;;;"}